<!DOCTYPE>
<html>
<head>
	<title>OIDC Callback</title>
</head>
<body>
You have reached an OIDC Callback page.
<a href="/">Home</a>
<script type="module">
const { apiClient, genUserManager } = await import("/config.js");

const url = new URL(window.location);
const iss = new URL(url.searchParams.get("iss"));

const idpConfigs = await apiClient.getOidcConfig();
const idp = idpConfigs.config.find((idp) => idp.issuer.toString() === iss.toString());
if (!idp) {
	throw new Error("Unable to identify IdP in callback");
}
const userManager = genUserManager(idp);
const user = await userManager.signinCallback();
const { id_token } = user;

const traceUser = await apiClient.authenticateOidc(id_token);
console.log(traceUser);

</script>
</body>
</html>
